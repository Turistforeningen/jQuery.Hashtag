// Generated by CoffeeScript 1.4.0

/*
 * jQuery Hashtag, a light weight hashtag function binding
 * utility for jQuery with support for regular expressions.
 *
 * Written by Hans Kristian Flaatten for Turistforeningen,
 * http://www.turistforeningen.no
 *
 * Version 1.0.0
 * Full source at https://github.com/Turistforeningen/jQuery.Hashtag
 * Copyright (c) 2012 Turistforeningen @  http://www.turistforeningen.com
 *
 * MIT License, https://github.com/Turistforeningen/jQuery.Hashtag/blob/master/LICENSE.md
 *
*/


(function() {
  "use strict";

  $(window).on('hashchange', function(e) {
    $(this).Hashtag('trigger');
    e.preventDefault();
    e.stopPropagation();
    return false;
  });

  jQuery(function($) {
    var hash, history, methods, routs, stop;
    routs = {};
    history = [];
    stop = null;
    Array.prototype.peek = function() {
      return this[this.length - 1];
    };
    hash = function() {
      var tag;
      tag = window.location.hash.replace('#', '');
      if (typeof tag === 'undefined') {
        tag = '';
      }
      return tag;
    };
    methods = {
      init: function(options) {
        if (options != null) {
          $.extend(routs, options);
        }
        return this;
      },
      trigger: function(tag) {
        var last;
        if (tag == null) {
          tag = hash();
        }
        last = history.peek();
        history.push(tag);
        if (typeof stop === 'function') {
          stop(tag, last);
        }
        stop = null;
        $.each(routs, function(pattern, rule) {
          var regexp;
          regexp = new RegExp(pattern, 'i');
          if (regexp.test(tag)) {
            if (typeof rule.stop === 'function') {
              stop = rule.stop;
            } else {
              stop = null;
            }
            if (typeof rule.start === 'function') {
              rule.start(tag, last);
            }
          }
        });
        return this;
      },
      goBack: function() {
        stop = null;
        history.pop();
        return $.fn.Hashtag('set', history.pop());
      },
      set: function(tag) {
        window.location.hash = tag;
        return this;
      },
      bind: function(tag, opts) {
        routs[tag] = opts;
        $.fn.Hashtag('trigger');
        return this;
      },
      unbind: function(tag) {
        routs[tag] = void 0;
        return this;
      }
    };
    return $.fn.Hashtag = function(method) {
      if (methods[method] != null) {
        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
      } else if (typeof method === "object" || !method) {
        return methods.init.apply(this, arguments);
      } else {
        return $.error('Method ' + method + ' does not exist on jQuery.Hashtag');
      }
    };
  });

}).call(this);
